<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product CRUD</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
    <h2 class="text-center mb-4">Product Management</h2>

    <!-- Add Product Form -->
    <div class="card p-3 mb-4">
        <h4 id="formTitle">Add Product</h4>
        <form id="productForm">
            <div class="mb-3">
                <label>Name</label>
                <input type="text" id="name" class="form-control" required>
            </div>
            <div class="mb-3">
                <label>Description</label>
                <textarea id="description" class="form-control" required></textarea>
            </div>
            <div class="mb-3">
                <label>Price</label>
                <input type="number" id="price" class="form-control" required>
            </div>
            <div class="mb-3">
                <label>Quantity</label>
                <input type="number" id="quantity" class="form-control" required>
            </div>
            <button type="submit" class="btn btn-primary" id="submitBtn">Add Product</button>
        </form>
    </div>

    <!-- Product List -->
    <div class="card p-3">
        <h4>Product List</h4>
        <table class="table table-bordered" id="productTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Price</th>
                    <th>Quantity</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script>
    const apiURL = "http://127.0.0.1:8000/api/products/";
    let editId = null;

    // Fetch products
    async function loadProducts() {
        let res = await fetch(apiURL);
        let data = await res.json();
        let table = document.querySelector("#productTable tbody");
        table.innerHTML = "";

        if (data.length === 0) {
            table.innerHTML = `<tr><td colspan="6" class="text-center">No products found</td></tr>`;
        } else {
            data.forEach(product => {
                table.innerHTML += `
                    <tr>
                        <td>${product.id}</td>
                        <td>${product.name}</td>
                        <td>${product.description}</td>
                        <td>${product.price}</td>
                        <td>${product.quantity}</td>
                        <td>
                            <button class="btn btn-warning btn-sm" onclick="editProduct(${product.id}, '${product.name}', '${product.description}', ${product.price}, ${product.quantity})">Edit</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteProduct(${product.id})">Delete</button>
                        </td>
                    </tr>`;
            });
        }
    }

    // Add or Update product
    document.getElementById("productForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        let name = document.getElementById("name").value;
        let description = document.getElementById("description").value;
        let price = document.getElementById("price").value;
        let quantity = document.getElementById("quantity").value;

        let method = editId ? "PUT" : "POST";
        let url = editId ? apiURL + editId + "/" : apiURL;

        await fetch(url, {
            method: method,
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, description, price, quantity })
        });

        alert(editId ? "Product updated successfully!" : "Product added successfully!");
        editId = null;
        document.getElementById("submitBtn").textContent = "Add Product";
        document.getElementById("formTitle").textContent = "Add Product";
        e.target.reset();
        loadProducts();
    });

    // Delete product
    async function deleteProduct(id) {
        if (confirm("Are you sure you want to delete this product?")) {
            await fetch(apiURL + id + "/", { method: "DELETE" });
            alert("Product deleted successfully!");
            loadProducts();
        }
    }

    // Edit product
    function editProduct(id, name, description, price, quantity) {
        document.getElementById("name").value = name;
        document.getElementById("description").value = description;
        document.getElementById("price").value = price;
        document.getElementById("quantity").value = quantity;
        document.getElementById("submitBtn").textContent = "Update Product";
        document.getElementById("formTitle").textContent = "Update Product";
        editId = id;
    }

    // Load products on page load
    loadProducts();
</script>

</body>
</html>
